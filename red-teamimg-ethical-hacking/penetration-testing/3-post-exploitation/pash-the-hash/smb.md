# SMB

### What is PsExec Authentication?

**PsExec** is a tool from Microsoft Sysinternals used to execute processes remotely on Windows machines, mainly over **SMB** (port 445). It allows you to run commands on a remote system using Windows authentication.

<figure><img src="../../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Windows dosent have a banner to say it is winrm.We can tell if it winrm by port  5985 - 5986
{% endhint %}

## Metasploit module&#x20;

Trough smb using pesexec

### Exploit

We need to use payload ,set target, set the hashes

<figure><img src="../../../../.gitbook/assets/image (7) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Use paylaod metepreter
{% endhint %}

### Bruteforce Login Auxiliary

<figure><img src="../../../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

## &#x20;crackmapexec

CrackMapExec is a Swiss Army knife for pentesters that helps automate:

* Credential validation across many hosts
* Lateral movement via SMB, WinRM, or others
* Executing commands remotely
* Harvesting credentials and hashes
* Checking SMB shares and system info

### Basic Usage Syntax

```bash
crackmapexec <protocol> <target> [options]
```

* `<protocol>`: `smb`, `winrm`, `rdp`, `mssql`, etc.
* `<target>`: IP, IP range, CIDR, or list of IPs (e.g., `10.10.10.0/24`)

### Common Examples

1. SMB Login Check with Username & Password

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -p 'Password123'
```

2. Using Username and NTLM Hash (Pass-the-Hash)

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -H <NTLM_HASH>
```

3. Using a Password List for Password Spraying

```bash
crackmapexec smb 10.10.10.0/24 -u administrator -p /path/to/password_list.txt
```

4. Use with a File of Credentials

```
crackmapexec smb 10.10.10.0/24 -C creds.txt
```

Where `creds.txt` format:

```
username:password
user2:pass2
```

### Important Flags and Options

| Option        | Description                              |
| ------------- | ---------------------------------------- |
| `-u`          | Username                                 |
| `-p`          | Password or password list                |
| `-H`          | NTLM hash (pass-the-hash)                |
| `-d`          | Domain name                              |
| `-x`          | Execute command remotely                 |
| `--shares`    | List SMB shares                          |
| `--users`     | Enumerate users                          |
| `--lsa`       | Dump LSA secrets (requires privileges)   |
| `-M <module>` | Run a specific module (e.g., `mimikatz`) |

## Run commands on target

Basic syntax to run a command on a target

```
crackmapexec smb <target-ip-or-range> -u <username> -p <password> -x "<command>"
```

Example: Run `whoami` on a single host

```
crackmapexec smb 10.10.10.123 -u administrator -p 'Password123' -x "whoami"
```

## Psexec Exe&#x20;

{% file src="../../../../.gitbook/assets/PSTools.zip" %}

