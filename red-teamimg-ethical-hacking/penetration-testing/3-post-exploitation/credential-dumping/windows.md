# Windows

<figure><img src="../../../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

## SAM database

<figure><img src="../../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

## LM Hash Algorithm

<figure><img src="../../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

## NTLM hash Algorithm

<figure><img src="../../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

## Metasploit Hashdump

The `hashdump` command will list the content of the SAM database. The SAM (Security Account Manager) database stores user's passwords on Windows systems. These passwords are stored in the NTLM (New Technology LAN Manager) format.

## &#x20;Mimikatz/**Kiwi**

#### üß† What is **Mimikatz**?

**Mimikatz** is a powerful post-exploitation tool used to:

* Extract plaintext passwords
* Dump password hashes
* Retrieve Kerberos tickets
* Perform **pass-the-hash**, **pass-the-ticket**, **Golden Ticket**, and more

It‚Äôs used heavily in **red teaming**, **penetration testing**, and also by real-world attackers.

{% hint style="warning" %}
Incase we dont have access with meterpreter to use kiwi we can install and use the mimikatz file
{% endhint %}

```
.\mimikatz.exe on windows if not meterpreter shell
```

üõ†Ô∏è How to Load and Use `kiwi` in Meterpreter:

<pre><code><strong>meterpreter> load kiwi
</strong></code></pre>

```
meterpreter> help kiwi
```

You‚Äôll see commands like:

| Command                       | Description                      |
| ----------------------------- | -------------------------------- |
| `creds_all`                   | Dump all available credentials!! |
| `lsa_dump_sam`                | Dump SAM database!!              |
| `kerberos_ticket_list`        | List Kerberos tickets            |
| `kerberos_ticket_purge`       | Purge tickets                    |
| `kerberos_ticket_use`         | Pass-the-ticket                  |
| `golden_ticket_create`        | Create golden ticket             |
| `sekurlsa_search_credentials` | Dump plaintext creds from memory |

<figure><img src="../../../../.gitbook/assets/Screenshot 2025-07-17 203009.png" alt=""><figcaption></figcaption></figure>

## **Windows configuration files**

Such files are usually used in enterprise automated deployments and **should be securely deleted after setup**.

When installing Windows on a large number of hosts, administrators may use Windows Deployment Services, which allows for a single operating system image to be deployed to several hosts through the network. These kinds of installations are referred to as unattended installations as they don't require user interaction. Such installations require the use of an administrator account to perform the initial setup, which might end up being stored in the machine in the following locations:

Located in:

```
C:\Windows\Panther
```

File:

* C:\Unattend.xml
* C:\Windows\Panther\Unattend.xml
* C:\Windows\Panther\Unattend\Unattend.xml
* C:\Windows\system32\sysprep.inf
* C:\Windows\system32\sysprep\sysprep.xml

{% hint style="warning" %}
**Password is encoded in base64**
{% endhint %}

| Path                             | Contains Passwords? | Details                                                                                   |
| -------------------------------- | ------------------- | ----------------------------------------------------------------------------------------- |
| `C:\Windows\System32\config\SAM` | ‚úÖ (hashed)          | Local account password hashes                                                             |
| `C:\Windows\NTDS\NTDS.dit`       | ‚úÖ (hashed)          | Domain account hashes (AD)                                                                |
| `C:\Windows\Panther`             | ‚ùå (usually)         | Setup logs, but may contain plaintext passwords in config files during automated installs |

## Powershell History

Whenever a user runs a command using Powershell, it gets stored into a file that keeps a memory of past commands. This is useful for repeating commands you have used before quickly. If a user runs a command that includes a password directly as part of the Powershell command line, it can later be retrieved by using the following command from a `cmd.exe` prompt:

```
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
```

**Note:** The command above will only work from cmd.exe, as Powershell won't recognize `%userprofile%` as an environment variable. To read the file from Powershell, you'd have to replace `%userprofile%` with `$Env:userprofile`.&#x20;

## Saved Windows Credentials

Windows allows us to use other users' credentials. This function also gives the option to save these credentials on the system. The command below will list saved credentials:

```shell-session
cmdkey /list
```

While you can't see the actual passwords, if you notice any credentials worth trying, you can use them with the `runas` command and the `/savecred` option, as seen below.

```shell-session
runas /savecred /user:admin cmd.exe
```

## IIS Configuration

Internet Information Services (IIS) is the default web server on Windows installations. The configuration of websites on IIS is stored in a file called `web.config` and can store passwords for databases or configured authentication mechanisms. Depending on the installed version of IIS, we can find web.config in one of the following locations:

* C:\inetpub\wwwroot\web.config
* C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config

Here is a quick way to find database connection strings on the file:

```shell-session
type C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config | findstr connectionString
```

## Retrieve Credentials from Software: PuTT

```
reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f "Proxy" /s
```

